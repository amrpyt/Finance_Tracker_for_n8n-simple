# 6.1 Trigger.dev Foundation and RORK Integration

Status: Ready for Review
Owner: James (Dev)
Depends on: Trigger.dev project access ✅, RORK API (free endpoint) ✅

## Dev Agent Record

### Implementation Status
- ✅ **Task 1**: Create trigger.config.ts with project ref and task directories
- ✅ **Task 2**: Implement health:ping task for sanity check
- ✅ **Task 3**: Implement rork:test task with retry handling
- ✅ **Task 4**: Configure environment variables (RORK requires no auth)
- ✅ **Task 5**: Deploy to production and validate task execution
- ✅ **Task 6**: Update project documentation

### Agent Model Used
GPT-4 (Cascade)

### Debug Log References
- Local dev server: ✅ Working - tasks visible and executable
- Production deployment: ✅ Version 20251003.2 deployed successfully
- Task execution: ✅ Both health:ping and rork:test tasks working in dev and prod
- RORK API connectivity: ✅ Validated (no authentication required)

### Completion Notes
1. **Trigger.dev Foundation**: Successfully established with project `proj_xjxlcyltnccogwcsxiir`
2. **Task Implementation**: Created 2 initial tasks with proper retry strategies
3. **RORK Integration**: Validated connectivity to free RORK API endpoint
4. **Environment Setup**: Configured proper environment variables
5. **Deployment**: Successfully deployed to production environment
6. **Documentation**: Created comprehensive README and updated project docs

### File List
```
trigger.config.ts                    # Main Trigger.dev configuration
trigger/src/tasks/health.ts          # Health check task
trigger/src/tasks/rork.ts            # RORK API integration task
trigger/src/tasks/index.ts           # Task exports
trigger/README.md                    # Trigger.dev documentation
package.json                         # Updated with Trigger.dev dependencies
.env.example                         # Updated with Trigger.dev variables
tsconfig.json                        # Updated to include trigger files
```

### Change Log
- **2025-10-03**: Initial Trigger.dev setup and configuration
- **2025-10-03**: Implemented health:ping and rork:test tasks
- **2025-10-03**: Successfully deployed to production (version 20251003.2)
- **2025-10-03**: Validated task execution and RORK connectivity

## Objective
Establish Trigger.dev in the repo with clean configuration and validate connectivity and error-handling with RORK. Create initial tasks, environment variables, and deployment flow (staging → production).

## Problem / Context
We currently rely on a Node bot server for orchestration. We want Trigger.dev to own orchestration, retries, and monitoring. Before migrating message handling, we must validate Trigger.dev foundation and RORK call robustness.

## Technical Approach
- Add `trigger.config.ts` with:
  - `project` ref, `dirs` to tasks folder (e.g., `./trigger/src/tasks`).
  - Default `maxDuration` suitable for AI calls (e.g., 120–300s initially).
  - Enable console logging for dev.
- Ensure TypeScript includes `trigger.config.ts` in `tsconfig.json`.
- Define initial tasks:
  - `health:ping` (sanity check, returns OK).
  - `rork:test` calling RORK with `retry.onThrow()` handling 429 and network errors; tag runs `rork`.
- Configure env vars in Trigger.dev dashboard: `RORK_API_KEY`, and any base URLs.
- Pin CLI/SDK versions to avoid compatibility issues; document version-locking impact.
- Deploy to staging; run tasks manually from dashboard and from code.

## Acceptance Criteria
- `trigger.config.ts` present with project ref and task dirs; visible in logs during dev.
- Tasks `health:ping` and `rork:test` are deployable and runnable from dashboard.
- RORK request uses retry strategy and respects rate limits; errors visible with traces.
- Env vars present in Trigger.dev; tasks read them via `process.env.*`.
- CI or manual deploy documented; preview branches optional but documented.
- Evidence: screenshots or run URLs linked in PR.

## QA Gates
- Task runs succeed in staging with deterministic output.
- Forced network failure triggers retry logic and then fails gracefully.
- Logs and spans visible; tags filterable (e.g., `rork`).

## Out of Scope
- Telegram webhook handling.
- Business logic migration.

## Notes / References
- Trigger.dev: tasks, retries, environment variables, versioning, deployment, context.
