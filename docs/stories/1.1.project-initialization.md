# Story 1.1: Project Initialization & Repository Setup

## Status

Approved

---

## Story

**As a** developer,  
**I want** a properly structured monorepo with Convex and bot directories,  
**so that** I have a clean foundation for building the application.

---

## Acceptance Criteria

1. Repository created with `/convex` and `/bot` directories
2. Convex project initialized with `npx convex dev` and basic schema file created
3. Bot directory contains package.json with `node-telegram-bot-api` or equivalent dependency
4. README.md created with project overview, setup instructions, and architecture diagram
5. `.gitignore` configured to exclude `node_modules`, `.env`, and Convex local files
6. Environment variable template (`.env.example`) created for `TELEGRAM_BOT_TOKEN`, `RORK_API_KEY`, `CONVEX_URL`
7. Git repository initialized with initial commit

---

## Tasks / Subtasks

- [ ] **Task 1: Initialize Root Monorepo Structure** (AC: 1, 7)
  - [ ] Create root directory `finance-tracker-telegram-bot/`
  - [ ] Initialize git repository with `git init`
  - [ ] Create root `package.json` with npm workspaces configuration
  - [ ] Create root `tsconfig.json` with shared TypeScript configuration
  - [ ] Create `.gitignore` file with appropriate patterns (AC: 5)
  - [ ] Create `.prettierrc` and `.eslintrc.json` for code quality
  - [ ] Create initial directory structure: `bot/`, `convex/`, `shared/`, `docs/`, `scripts/`

- [ ] **Task 2: Initialize Convex Backend** (AC: 2)
  - [ ] Navigate to project root and run `npx convex dev --once` to initialize Convex
  - [ ] Create `convex/schema.ts` with basic schema structure
  - [ ] Create `convex/package.json` with Convex dependencies
  - [ ] Create `convex/tsconfig.json` with Convex-specific TypeScript configuration
  - [ ] Create `convex/README.md` documenting Convex backend structure
  - [ ] Verify Convex initialization by checking for `convex/_generated/` directory

- [ ] **Task 3: Initialize Bot Server** (AC: 3)
  - [ ] Create `bot/package.json` with required dependencies (node-telegram-bot-api, express, convex, dotenv, winston)
  - [ ] Create `bot/tsconfig.json` with bot-specific TypeScript configuration and path aliases
  - [ ] Create `bot/src/` directory structure: `config/`, `handlers/`, `services/`, `utils/`, `types/`
  - [ ] Create placeholder `bot/src/index.ts` entry point file
  - [ ] Create `bot/jest.config.js` for testing configuration
  - [ ] Create `bot/README.md` documenting bot server structure
  - [ ] Run `npm install` in bot directory to install dependencies

- [ ] **Task 4: Create Environment Configuration** (AC: 6)
  - [ ] Create root `.env.example` with all required environment variables
  - [ ] Create `bot/.env.example` with bot-specific variables
  - [ ] Create `convex/.env.local.example` with Convex-specific variables
  - [ ] Document each environment variable with comments explaining purpose
  - [ ] Add `.env` and `.env.local` to `.gitignore` to prevent committing secrets

- [ ] **Task 5: Create Shared Package** (AC: 1)
  - [ ] Create `shared/package.json` with shared package configuration
  - [ ] Create `shared/tsconfig.json` for shared types
  - [ ] Create `shared/src/types/` directory for shared TypeScript interfaces
  - [ ] Create `shared/src/constants/` directory for shared constants
  - [ ] Create `shared/src/utils/` directory for shared utilities
  - [ ] Create `shared/README.md` documenting shared package purpose

- [ ] **Task 6: Create Documentation** (AC: 4)
  - [ ] Create root `README.md` with project overview
  - [ ] Add setup instructions section with step-by-step guide
  - [ ] Add architecture diagram (can be text-based mermaid or ASCII art)
  - [ ] Document required tools and versions (Node.js 18.x, npm 9+)
  - [ ] Add links to Convex dashboard and Telegram BotFather
  - [ ] Document development workflow (how to run bot and Convex locally)

- [ ] **Task 7: Create Build and Utility Scripts** (AC: 1)
  - [ ] Create `scripts/` directory at root
  - [ ] Create `scripts/setup.sh` for initial project setup automation
  - [ ] Create `scripts/check-env.sh` for environment variable validation
  - [ ] Make scripts executable with appropriate permissions
  - [ ] Document script usage in root README.md

- [ ] **Task 8: Configure CI/CD Placeholder** (AC: 1)
  - [ ] Create `.github/workflows/` directory
  - [ ] Create placeholder `ci.yaml` workflow file (can be minimal)
  - [ ] Create placeholder `lint.yaml` workflow file
  - [ ] Document CI/CD setup in README.md

- [ ] **Task 9: Create Initial Commit** (AC: 7)
  - [ ] Stage all created files with `git add .`
  - [ ] Create initial commit with message "Initial project setup with monorepo structure"
  - [ ] Verify commit with `git log`
  - [ ] Optionally create `.github/` directory with issue templates

- [ ] **Task 10: Verify Project Structure**
  - [ ] Run `npm install` at root to install all workspace dependencies
  - [ ] Verify TypeScript compilation works in all workspaces
  - [ ] Verify no sensitive data committed (check for .env files)
  - [ ] Verify all package.json files have correct workspace references
  - [ ] Test that scripts are executable and documented

---

## Dev Notes

### Architecture Context

This story establishes the foundational monorepo structure for the Personal Finance Tracker Telegram Bot. The project uses a **hybrid serverless architecture** with three main packages: bot server, Convex backend, and shared utilities.

[Source: docs/architecture/high-level-architecture.md#repository-structure]

### Repository Structure

The monorepo uses **npm workspaces** (lightweight, no additional tooling) with the following organization:

```
finance-tracker-telegram-bot/
├── bot/          - Telegram bot server (Node.js/TypeScript)
├── convex/       - Convex backend functions and schema
├── shared/       - Shared TypeScript types and utilities
├── docs/         - Project documentation
├── scripts/      - Build and deployment scripts
└── .github/      - GitHub configuration
```

[Source: docs/architecture/source-tree.md#complete-directory-tree]

### Technology Stack

**Core Technologies:**
- **Node.js:** 18.x LTS (runtime environment)
- **TypeScript:** 5.3+ (type-safe development)
- **npm:** 9+ (package management)
- **Convex:** Latest (serverless backend platform)
- **node-telegram-bot-api:** 0.64+ (Telegram Bot API integration)
- **Express:** 4.18+ (webhook server)
- **dotenv:** 16+ (environment configuration)

[Source: docs/architecture/tech-stack.md#core-technologies]

### Bot Server Dependencies

The `bot/package.json` must include:

```json
{
  "dependencies": {
    "node-telegram-bot-api": "^0.64.0",
    "express": "^4.18.2",
    "convex": "^1.0.0",
    "dotenv": "^16.3.1",
    "winston": "^3.11.0"
  },
  "devDependencies": {
    "@types/node": "^20.10.0",
    "@types/express": "^4.17.21",
    "@types/node-telegram-bot-api": "^0.64.0",
    "typescript": "^5.3.0",
    "jest": "^29.7.0",
    "@types/jest": "^29.5.0",
    "ts-jest": "^29.1.0",
    "eslint": "^8.55.0",
    "prettier": "^3.1.0"
  }
}
```

[Source: docs/architecture/tech-stack.md#package-dependencies]

### Convex Dependencies

The `convex/package.json` must include:

```json
{
  "dependencies": {
    "convex": "^1.0.0"
  },
  "devDependencies": {
    "vitest": "^1.0.0",
    "convex-test": "^0.0.1"
  }
}
```

[Source: docs/architecture/tech-stack.md#package-dependencies]

### Root Workspace Configuration

The root `package.json` must define workspaces:

```json
{
  "name": "finance-tracker-telegram-bot",
  "version": "1.0.0",
  "private": true,
  "workspaces": [
    "bot",
    "convex",
    "shared"
  ],
  "scripts": {
    "dev": "npm-run-all --parallel dev:*",
    "dev:bot": "npm run dev --workspace=bot",
    "dev:convex": "npm run dev --workspace=convex",
    "test": "npm run test --workspaces",
    "build": "npm run build --workspaces",
    "lint": "eslint . --ext .ts,.tsx",
    "format": "prettier --write \"**/*.{ts,tsx,json,md}\""
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.0.0",
    "@typescript-eslint/parser": "^6.0.0",
    "eslint": "^8.55.0",
    "prettier": "^3.1.0",
    "npm-run-all": "^4.1.5",
    "typescript": "^5.3.0"
  }
}
```

[Source: docs/architecture/source-tree.md#workspace-configuration]

### Environment Variables Required

The `.env.example` must include:

```bash
# Telegram Bot Configuration
TELEGRAM_BOT_TOKEN=your_bot_token_here

# Rork Toolkit API
RORK_API_KEY=your_rork_api_key_here

# Convex Configuration
CONVEX_URL=your_convex_deployment_url_here

# Logging
LOG_LEVEL=info
```

[Source: docs/architecture/tech-stack.md#external-service-requirements]

### Gitignore Patterns

The `.gitignore` must include:

```gitignore
# Dependencies
node_modules/
package-lock.json

# Environment variables
.env
.env.local
.env.*.local

# Build outputs
dist/
build/
*.tsbuildinfo

# Convex generated files
convex/_generated/

# Logs
*.log
logs/

# IDE
.vscode/
.idea/
*.swp
*.swo

# OS
.DS_Store
Thumbs.db

# Test coverage
coverage/
.nyc_output/

# Temporary files
tmp/
temp/
*.tmp
```

[Source: docs/architecture/source-tree.md#gitignore-patterns]

### File Naming Conventions

- **Code files:** camelCase (e.g., `userService.ts`, `transactionRepository.ts`)
- **Config files:** kebab-case (e.g., `tsconfig.json`, `config.api.json`)
- **Documentation files:** kebab-case (e.g., `tech-stack.md`, `coding-standards.md`)

[Source: docs/architecture/source-tree.md#file-naming-conventions]

### Path Alias Configuration

The `bot/tsconfig.json` must include path aliases:

```json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"],
      "@shared/*": ["../shared/src/*"]
    }
  }
}
```

[Source: docs/architecture/source-tree.md#path-alias-configuration]

### TypeScript Configuration

All TypeScript configurations must use strict mode:

```json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "strictFunctionTypes": true
  }
}
```

[Source: docs/architecture/coding-standards.md#use-strict-mode]

### Initial Convex Schema Structure

The `convex/schema.ts` should start with a basic structure (can be empty or minimal):

```typescript
import { defineSchema, defineTable } from "convex/server";
import { v } from "convex/values";

export default defineSchema({
  // Tables will be defined in subsequent stories
});
```

[Source: docs/architecture/source-tree.md#key-files-reference]

### Bot Server Entry Point

The `bot/src/index.ts` should be a placeholder for now:

```typescript
// Placeholder - will be implemented in Story 1.2
console.log("Bot server initialized");
```

[Source: docs/architecture/source-tree.md#entry-points]

### Testing

#### Test File Locations

- **Bot tests:** `bot/tests/` directory with subdirectories matching `src/` structure
- **Convex tests:** `convex/tests/` directory
- **Shared tests:** `shared/tests/` directory (if needed)

[Source: docs/architecture/source-tree.md#bot-server-bot]

#### Testing Frameworks

- **Bot Server:** Jest 29+ for unit and integration tests
- **Convex:** Vitest 1.0+ and Convex Test for function tests

[Source: docs/architecture/tech-stack.md#testing]

#### Test Configuration

Create `bot/jest.config.js`:

```javascript
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'node',
  roots: ['<rootDir>/tests'],
  testMatch: ['**/*.test.ts'],
  moduleNameMapper: {
    '^@/(.*)$': '<rootDir>/src/$1',
    '^@shared/(.*)$': '<rootDir>/../shared/src/$1',
  },
};
```

[Source: docs/architecture/coding-standards.md#testing-standards]

#### Testing Standards

- No tests required for this story (infrastructure setup only)
- Test infrastructure must be configured for future stories
- Test coverage requirements: 80%+ for Convex functions, 60%+ for bot handlers

[Source: docs/architecture/coding-standards.md#test-coverage-requirements]

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-30 | 1.0 | Initial story creation | Scrum Master (Bob) |

---

## Dev Agent Record

*This section will be populated by the development agent during implementation.*

### Agent Model Used

*To be filled by dev agent*

### Debug Log References

*To be filled by dev agent*

### Completion Notes List

*To be filled by dev agent*

### File List

*To be filled by dev agent*

---

## QA Results

*Results from QA Agent review will be added here after implementation.*
