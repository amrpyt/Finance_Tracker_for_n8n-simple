# Technical Assumptions - Personal Finance Tracker

**Version:** 1.0  
**Date:** 2025-09-30

---

## Repository Structure

**Monorepo**

Single repository with primary runtime directory:
- `/convex` - Serverless backend functions, database schema, AI integration

Legacy (retained for reference only):
- `/bot` - Historical bot server code; not used in Convex-only deployment

---

## Service Architecture

**Convex-Only Architecture:**
- **Convex HTTP Action:** Receives Telegram webhook callbacks directly; validates and acknowledges within <200ms
- **Convex Actions/Mutations/Queries:** Execute business logic, database operations, and AI calls
- **Communication:** Telegram → Convex HTTP Action → Convex Actions → Convex DB → Telegram
- **AI Integration:** Convex actions call the Rork Toolkit API for natural language understanding

**Rationale:** Eliminates the bot server to reduce complexity and costs. Single-platform (Convex) architecture simplifies deployment, logging, and maintenance while preserving performance and feature set.

---

## Testing Requirements

**Unit + Integration Testing:**
- **Unit Tests:** Core business logic in Convex functions (transaction creation, balance calculation, loan tracking)
- **Integration Tests:** End-to-end flows from Telegram message → AI processing → Database update → Response
- **Manual Testing:** Natural language understanding accuracy requires human validation with diverse Arabic/English inputs
- **Test Data:** Create sample user profiles with realistic transaction patterns for regression testing

**Rationale:** AI-driven systems require both automated testing for logic and manual testing for language understanding quality.

---

## Additional Technical Assumptions and Requests

- **Language/Runtime:** TypeScript for Convex functions
- **Bot Framework:** Not applicable (Telegram handled via Convex HTTP Action)
- **AI/LLM Provider:** Rork Toolkit API (existing config in `config.api.json`) - no OpenAI/Anthropic
- **Database:** Convex built-in database with JSON documents and relational model
- **Deployment:** Convex auto-deploys backend (single platform)
- **Environment Variables:** Telegram Bot Token (from @BotFather); `CONVEX_URL` auto-generated by Convex CLI
- **Error Handling:** Implement retry logic for AI API calls with exponential backoff
- **Logging:** Structured logging for debugging AI interpretation errors and transaction issues
- **Data Model:** Tables for `users`, `accounts`, `transactions`, `loans`, `loan_payments`
- **Rate Limiting:** Implement per-user rate limits to prevent spam (max 10 transactions/minute)
- **Localization:** Store user language preference (Arabic/English) in user profile for consistent responses
- **Currency:** Default to Egyptian Pounds (EGP) for MVP; currency symbol detection from user input

---

**Related Documents:**
- [Overview](./overview.md)
- [Requirements](./requirements.md)
- [Epic List](./epics.md)
